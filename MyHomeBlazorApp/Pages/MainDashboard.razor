@page "/maindashboard"
@using MyHome.Models;
@using MyHomeBlazorApp.BlazorData;
@using MyHome;
@using MyHomeBlazorApp.Pages
@using BlazorBootstrap
@using MyHomeBlazorApp.Components
@inject NavigationManager uriHelper;
@inject BlazorData.DataService DataService;

<html>
<head>
    <style>
        .grid-container {
            display: flex;
            grid-template-columns: auto auto auto;
            background-color: #f7f9fc;
            padding: 10px;
            flex-direction: row;
            flex-wrap: wrap;
        }

        .grid-item {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.8);
            padding: 20px;
            margin: 20px;
            font-size: 30px;
            text-align: center;
        }

        .body {
            background-color: #ced4da;
            color: #6c757d;
        }

        .th {
            column-width: 100px;
        }

        .a {
            width: 100px;
            white-space: nowrap;
            overflow: hidden;
            border: 1px solid;
            text-overflow: ellipsis;
        }

        .card-outline-style {
            outline-width: 5px;
            outline-style: double;
            outline-color: darkgoldenrod;
        }

        .card-style {
            display: flex;
            justify-content: center;
            background-color: #eeeff4;
            width: 18rem;
            margin-right: 50px;
            margin-top: 50px;
        }

        .svg-icon-style {
            width: 100px;
            height: 100px;
            display: flex;
            margin-right: auto;
            margin-left: auto;
            align-items: center;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
        }

        .card-footer {
            width: 100%;
            background-color: none;
            border-top: none;
            justify-content: left;
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
            text-align: left;
        }

        .card-btn {
            color: #2d2a2b;
            background-color: #cfd9e1;
            border-color: #1861ac;
            border-radius: 1.3rem;
        }

        .card-btn:hover
        {
            padding-left: 1rem;
            padding-right: 1rem;
            font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
                background: #e2c8c0;
                color: #2d2a2b;
        }

        .bodySection {
            background-image: url(/Images/freepik__retouch__10901.png);
            background-repeat: repeat;
            position: relative;
            /* background-size: cover; */
            background-position: center;
            position: relative; /* Needed for overlay positioning */
            height: 100vh;
        }

            .bodySection::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(255, 255, 255, 0.7); /* Dark overlay */
                z-index: 1;
            }

        .bodySection-content {
            position: relative;
            z-index: 2; /* Place content above overlay */
        }
    </style>
</head>
<PageTitle>Main Dashboard</PageTitle>

<body>
    <main class="bodySection">
    <section class="bodySection-content">
    <div class="content">
        <div class="container-fluid">
            <div class="row d-flex justify-content-center text-bg-dark">
                <Card Class="mb-4 card-style">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="#e2c8c0" class="svg-icon-style" viewBox="0 0 16 16">
                        <path d="@userIconPath" />
                    </svg>
                    <CardBody>
                        <CardTitle class="fw-bolder">Welcome Back, @DataService.CurrentUserWithAllData.UserName!</CardTitle>
                        <CardText>Date Today: </CardText>
                        <CardText>@DateTime.UtcNow.ToLongDateString()</CardText>
                    </CardBody>
                  @*   <ul>
                    </ul> *@
                    <CardBody Class="text-center">
                        <CardLink Class="btn btn-primary card-btn btn-rounded" To="Account/Manage">User Account</CardLink>
                    </CardBody>
                </Card>
                <Card Class="mb-4 card-style">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="#e2c8c0" class="svg-icon-style" viewBox="0 0 16 16">
                        <path d="@realEstateIconPath" />
                    </svg>
                    <CardBody>
                        <CardTitle class="fw-bolder">Total Real Estates: @DataService.CurrentUserWithAllData.RealEstates.Count</CardTitle>
                        <CardText>Last Added Real Estate:</CardText>
                        <CardText>
                            ID: @DataService.LastAddedRealEstate().RealEstateID |
                            @DataService.LastAddedRealEstate().RealEstateName
                        </CardText>
                    </CardBody>
                    <CardBody Class="text-center">
                        <CardLink Class="btn btn-primary card-btn btn-rounded" To="/details/1">All RealEstates</CardLink>
                    </CardBody>
                </Card>
                <Card Class="mb-4 card-style">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="#e2c8c0" class="svg-icon-style" viewBox="0 0 16 16">
                        <path d="@deviceIconPath" />
                    </svg>
                    <CardBody>
                        <CardTitle class="fw-bolder">Total Devices: @DataService.Devices?.Count</CardTitle>
                        <CardText>Last Added Device:</CardText>
                        <CardText Class="">
                            ID:
                            @DataService.LastAddedDevice().DeviceID |
                            @DataService.LastAddedDevice().DeviceName
                        </CardText>
                    </CardBody>
                    <CardBody Class="text-center">
                        <CardLink Class="btn btn-primary card-btn btn-rounded" To="/details/2">All Devices</CardLink>
                    </CardBody>
                </Card>
                @if (GetExpiringDevice != null)
                {
                    <Card Class="mb-4 card-style" Style="width:18rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="#e2c8c0" class="svg-icon-style" viewBox="0 0 16 16">
                            <path d="@warrantyIconPath" />
                        </svg>
                        <CardBody>
                            <CardTitle class="fw-bolder">Warranties</CardTitle>
                            <CardText>Expires soonest:</CardText>
                            <CardText Class="">
                                @DataService.FirstExpiringWarranty().DeviceName |
                                @DataService.FirstExpiringWarranty().DeviceWarranty.WarrantyEnd.ToShortDateString()
                            </CardText>
                        </CardBody>
                        <CardBody Class="text-center">
                            <CardLink Class="btn btn-primary card-btn btn-rounded" To="/details/3">All Warranties</CardLink>
                        </CardBody>
                    </Card>
                }
                else
                {
                    DataService.CurrentUserWithAllData.GetAllDevices().Last();
                }
            </div>
        </div>
    </div>
    </section>
    </main>
</body> 
</html>
@code {
    private DeviceProfile? _expiringDevice { get; set; }
    private List<string> _deviceItemsList = new List<string>();
    private List<string> _warrantyItemsList = new List<string>();
    private List<string> _realEstateItemsList = new List<string>();
    private List<string> GetExpiringDevice()
    {
        _warrantyItemsList = new();
        string dateInput = "No expiring warranties!";
        string deviceName = string.Empty;
        DeviceProfile firstExpiringDevice = DataService.FirstExpiringWarranty();
        if (firstExpiringDevice.DeviceID != 0)
        {
            dateInput = DataService.FirstExpiringWarranty().DeviceWarranty.WarrantyEnd.ToShortDateString();
            deviceName = DataService.FirstExpiringWarranty().DeviceName;
        }
        _warrantyItemsList.Add("Expires soonest:");
        _warrantyItemsList.Add(deviceName + " " + dateInput);
        return _warrantyItemsList;
    }

    private List<string> GetLastAddedDevice()
    {
        _deviceItemsList = new();
        DeviceProfile? lastDevice = DataService.LastAddedDevice();
        string deviceID = "0";
        if (lastDevice != null)
        {
            deviceID = lastDevice.DeviceID.ToString();
        }
        else
        {
            lastDevice = new();
        }
        string deviceName = lastDevice.DeviceName;
        string finalString = "ID" + ":" + lastDevice.DeviceID.ToString() + " " + lastDevice.DeviceName;
        _deviceItemsList.Add("Last Added Device:");
        _deviceItemsList.Add(finalString);
        return _deviceItemsList;
    }

    private List<string> GetLastAddedRealEstate()
    {
        _realEstateItemsList = new();
        RealEstate lastRealEstate = DataService.LastAddedRealEstate();
        string lastRealEstateId = lastRealEstate.RealEstateID.ToString();
        _realEstateItemsList.Add("Last added Real Estate:");
        _realEstateItemsList.Add($"ID:{lastRealEstateId} {lastRealEstate.RealEstateName}");
        return _realEstateItemsList;
    }

    List<string> userItemsList = new List<string>()
    {
        $"Date Today: {DateTime.UtcNow.ToLongDateString()}"
    };

    // protected override void OnAfterRender(bool firstRender)
    // {
    //     _expiringDevice = DataService.FirstExpiringWarranty();
    //     base.OnAfterRender(firstRender);
    // }

    // protected override void OnInitialized()
    // {
    //     _expiringDevice = DataService.FirstExpiringWarranty();
    // }

    string userIconPath = "M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0";
    string realEstateIconPath = "M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4z";
    string deviceIconPath = "M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14a2.5 2.5 0 0 1-2.5 2.5v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0m-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z";
    string warrantyIconPath = "M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1m-3 2v.634l.549-.317a.5.5 0 1 1 .5.866L7 7l.549.317a.5.5 0 1 1-.5.866L6.5 7.866V8.5a.5.5 0 0 1-1 0v-.634l-.549.317a.5.5 0 1 1-.5-.866L5 7l-.549-.317a.5.5 0 0 1 .5-.866l.549.317V5.5a.5.5 0 1 1 1 0m-2 4.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1m0 2h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1";


}
