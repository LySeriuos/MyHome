@page "/details"

@using Microsoft.AspNetCore.Components.QuickGrid
@using MyHome.Models;
@using MyHomeBlazorApp.BlazorData;
@using MyHome;
@using MyHomeBlazorApp.Pages
@using MyHomeBlazorApp.Components
@using BlazorBootstrap
@inject NavigationManager uriHelper;
@inject BlazorData.DataService DataService;



<h3>Details</h3>

<div class="row">
    <div class="col">
        <Button @onclick="ShowRealEstatesTable">Real Estates Details</Button>
        <Button @onclick="ShowDevicesTable">Devices Details</Button>
        <Button @onclick="ShowWarrantiesTable">Warranties Details</Button>
        <Button @onclick="ShowShopsTable">Shops Details</Button>
    </div>
</div>
<div class="row">
    @if (_showRealEstatesTableVisible)
    {
        <QuickGrid Items="@DataService.RealEstates.AsQueryable()">
            @* Here is "edit" button, but there are two different forms: Real Estate and Address. For logic reason these two should be combined as one editable form*@
            <TemplateColumn>
                <div>
                    <Button @onclick="OnShowModalClick">Edit</Button>
                    <Button>Delete</Button>
                </div>
            </TemplateColumn>
            <PropertyColumn Title="Real Estate ID" Property="@(r => r.RealEstateID)" Sortable="true" />
            <PropertyColumn Title="Real Estate Name" Property="@(r => r.RealEstateName)" Sortable="true" />
            <PropertyColumn Title="Street Name" Property="@(r => r.Address.StreetName)" Sortable="true" />
            <PropertyColumn Title="House Number" Property="@(r => r.Address.HouseNumber)" Sortable="true" />
            <TemplateColumn Title="House Number Extension">
                <NoData Text="@context.Address.HouseNumberExtension"></NoData>
            </TemplateColumn>
            <PropertyColumn Property="@(r => r.Address.City)" Sortable="true" />
            <PropertyColumn Property="@(r => r.Address.Country)" Sortable="true" />
            <PropertyColumn Title="Total Devices" Property="@(r => r.DevicesProfiles.Count())" />
        </QuickGrid>
    }
</div>
<div class="row">
    @if (_showDevicesTableVisible)
    {
        @foreach (RealEstate r in DataService.RealEstates)
        {
            <QuickGrid Items="@DataService.Devices.AsQueryable()">

                @* Here is "edit" button, but there are two different forms: Real Estate and Address. For logic reason these two should be combined as one editable form*@
                <TemplateColumn>
                    <div>
                        <Button>Edit</Button>
                        <Button>Delete</Button>
                    </div>
                </TemplateColumn>
                <TemplateColumn Title="Real Estate ID">
                    <span>@r.RealEstateID</span>
                </TemplateColumn>
                @* how to make output "no data" if user didn't put in details for alomst each part. Some will be   *@
                <PropertyColumn Title="ID" Property="@(d => d.DeviceID)" Sortable="true" />
                <PropertyColumn Title="Name" Property="@(d => d.DeviceName)" Sortable="true" />
                <PropertyColumn Title="Produser" Property="@(d => d.DeviceProduser)" Sortable="true" />
                <PropertyColumn Title="Type" Property="@(d => d.DeviceType)" Sortable="true" />
                <PropertyColumn Title="Serial Number" Property="@(d => d.DeviceSerialNumber)" Sortable="true" />
                <PropertyColumn Title="Model Number" Property="@(d => d.DeviceModelNumber)" Sortable="true" />
                <PropertyColumn Title="Ip Adrress" Property="@(d => d.IpAddress)" Sortable="true" />
                <PropertyColumn Title="Mac Adrress" Property="@(d => d.MacAdrress)" Sortable="true" />
                @* link to manual is not clickable, need to fix it! *@
                <PropertyColumn Title="Link To Manual" Property="@(d => d.ManualBookLink)" Sortable="true" />
                <TemplateColumn Title="Link">
                    <Button class="btn btn-sm" href="@context.ManualBookLink">Link</Button>
                </TemplateColumn>
                <PropertyColumn Title="Warranty Expires" Property="@(d => d.DeviceWarranty.WarrantyEnd.ToShortDateString())" Sortable="true" />
            </QuickGrid>
        }
    }
</div>
<div class="row">
    @if (_showWarrantiesTableVisible)
    {
        @foreach (RealEstate r in DataService.RealEstates)
        {
            <QuickGrid Items="@DataService.Devices.AsQueryable()">

                @* Here is "edit" button, but there are two different forms: Real Estate and Address. For logic reason these two should be combined as one editable form*@
                <TemplateColumn>
                    <div>
                        <Button>Edit</Button>
                        <Button>Delete</Button>
                    </div>
                </TemplateColumn>
                <TemplateColumn Title="Real Estate ID">
                    <span>@r.RealEstateID</span>
                </TemplateColumn>
                @* how to make output "no data" if user didn't put in details for alomst each part. Some will be *@
                <PropertyColumn Title="Device ID" Property="@(d => d.DeviceID)" Sortable="true" />
                <PropertyColumn Title="Purchase Date" Property="@(d => d.DeviceWarranty.PurchaseDate.ToShortDateString())" Sortable="true" />
                <PropertyColumn Title="Warranty Expires" Property="@(d => d.DeviceWarranty.WarrantyEnd.ToShortDateString())" Sortable="true" />
                <PropertyColumn Title="Warranty Length (Days)" Property="@(d => d.DeviceWarranty.WarrantyPeriod.TotalDays)" />
                @* it would be great for user to uppload the receipts or insurances to database to make it easy to find! Other method it could be linked in the user device *@
                <PropertyColumn Title="Receipt Link" Property="@(d => d.DeviceWarranty.ReceiptLink)" />
                <PropertyColumn Title="Extra Warranty/Insurance Length (Days)" Property="@(d => d.DeviceWarranty.ExtraInsuranceWarrantyLenght.TotalDays)" Sortable="true" />
                <PropertyColumn Title="Extra Warranty/Insurance Reciept Link" Property="@(d => d.DeviceWarranty.ExtraInsuranceWarrantyLink)" />
            </QuickGrid>
        }

    }
</div>
<div class="row">
    @if (_showShopsTableVisible)
    {

        @foreach (RealEstate r in DataService.RealEstates)
        {
            <QuickGrid tabindex="2" Items="@DataService.Devices.AsQueryable()">

                @* Here is "edit" button, but there are two different forms: Real Estate and Address. For logic reason these two should be combined as one editable form*@
                <TemplateColumn>
                    <div>
                        <Button>Edit</Button>
                        <Button>Delete</Button>
                    </div>
                </TemplateColumn>
                <TemplateColumn Title="Real Estate ID">
                    <span>@r.RealEstateID</span>
                </TemplateColumn>
                @* how to make output "no data" if user didn't put in details for alomst each part. Some will be *@
                <PropertyColumn Title="Device ID" Property="@(d => d.DeviceID)" Sortable="true" />
                <PropertyColumn Title="Shop Name" Property="@(d => d.DeviceWarranty.Shop.ShopName)" Sortable="true" />
                <PropertyColumn Title="Website Adrress" Property="@(d => d.DeviceWarranty.Shop.ShopWebAddress)" Sortable="true" />
                <PropertyColumn Title="Phone Number" Property="@(d => d.DeviceWarranty.Shop.PhoneNumber)" />
                <PropertyColumn Title="Street Name" Property="@(d => d.DeviceWarranty.Shop.Address.StreetName)" />
                <PropertyColumn Title="House Number" Property="@(d => d.DeviceWarranty.Shop.Address.HouseNumber)" />
                <PropertyColumn Title="Extended House Number/Letter" Property="@(d => d.DeviceWarranty.Shop.Address.HouseNumberExtension)" />
                <PropertyColumn Title="City" Property="@(d => d.DeviceWarranty.Shop.Address.City)" Sortable="true" />
                <PropertyColumn Title="Country" Property="@(d => d.DeviceWarranty.Shop.Address.Country)" Sortable="true" />
            </QuickGrid>
        }

    }
    <EditForm Model="DataService.RealEstates">
        <h3>Edit Real Estate Details</h3>
        <hr />
        <div class="form-group row">
            <label for="realEstateName" class="col-sm-2 col-form-label">
                Real Estate Name
            </label>
            <div class="col-sm-10">
                <InputText id="realEstateName" class="form-control" placeholder="Real Estate Name"
                           @bind-Value="DataService.CurrentRealEstate.RealEstateName" />
            </div>
        </div>
    </EditForm>
    <EditForm Model="DataService.CurrentRealEstate">
        <div class="form-group row">
            <label for="realEstateStreetName" class="col-sm-2 col-form-label">
                Real Estate Street Name
            </label>
            <div class="col-sm-10">
                <InputText id="realEstateStreetName" class="form-control" placeholder="Real Estate Street Name"
                           @bind-Value="DataService.CurrentRealEstate.Address.StreetName" />
            </div>
        </div>
        <div class="form-group row">
            <label for="realEstateHouseNumber" class="col-sm-2 col-form-label">
                Real Estate House Number
            </label>
            <div class="col-sm-10">
                <InputNumber id="realEstateHouseNumber" class="form-control" placeholder="Real Estate House Number"
                             @bind-Value="DataService.CurrentRealEstate.Address.HouseNumber" />
            </div>
        </div>
        <div class="form-group row">
            <label for="realEstateHouseNumberExtension" class="col-sm-2 col-form-label">
                Real Estate House Number Extension
            </label>
            <div class="col-sm-10">

                <InputText id="realEstateHouseNumberExtension" class="form-control" placeholder="Real Estate House Number Extension"
                           @bind-Value="DataService.CurrentRealEstate.Address.HouseNumberExtension" />
            </div>
        </div>
        <div class="form-group row">
            <label for="realEstateCity" class="col-sm-2 col-form-label">
                Real Estate City
            </label>
            <div class="col-sm-10">
                <InputText id="realEstateCity" class="form-control" placeholder="City"
                           @bind-Value="DataService.CurrentRealEstate.Address.City" />
            </div>
        </div>
        <div class="form-group row">
            <label for="realEstateCountry" class="col-sm-2 col-form-label">
                Real Estate Country
            </label>
            <div class="col-sm-10">
                <InputText id="realEstateCountry" class="form-control" placeholder="Country"
                           @bind-Value="DataService.CurrentRealEstate.Address.Country" />
            </div>
        </div>

    </EditForm>
    <div class="row">
        <div>
            <Button Color="ButtonColor.Primary">Save</Button>

            <Button Color="ButtonColor.Primary">Cancel</Button>
        </div>
    </div>
    
    <Modal @ref="modal" Title="Edit Real Estate Address">
        <BodyTemplate>
            <EditForm Model="DataService.RealEstates">
                <div class="form-group row">
                    <label for="realEstateName" class="col-sm-2 col-form-label">
                        Real Estate Name
                    </label>
                    <div class="col-sm-10">
                        <InputText id="realEstateName" class="form-control" placeholder="Real Estate Name"
                                   @bind-Value="DataService.CurrentRealEstate.RealEstateName" />
                    </div>
                </div>
            </EditForm>
            <AddressComponent CurrentObject="@GetCurrentRealEstate()"
                              ForAndIdStreetName="streetName"
                              LabelPlaceHolderStreetName="Street Name"
                              ForAndIdHouseNumber="houseNumber"
                              LabelPlaceHolderHouseNumber="House Number"
                              ForAndIdHouseNumberExtension="houseNumberExtension"
                              LabelPlaceHolderHouseNumberExtension="House Number Extension"
                              ForAndIdCity="city"
                              LabelPlaceHolderCity="City"
                              ForAndIdCountry="country"
                              LabelPlaceHolderCountry="Country" />
        </BodyTemplate>
        <FooterTemplate>
            <Button Color="ButtonColor.Primary" @onclick="OnHideModalClick">Close</Button>
            <Button Color="ButtonColor.Primary">Save changes</Button>
        </FooterTemplate>
    </Modal>
</div>


@code {
    private RealEstate realEstate;

    private RealEstate GetCurrentRealEstate()
    {
        realEstate = DataService.CurrentRealEstate;
        return realEstate;
    }


    bool _showRealEstatesTableVisible = true;
    bool _showDevicesTableVisible = false;
    bool _showWarrantiesTableVisible = false;
    bool _showShopsTableVisible = false;

    private void ShowRealEstatesTable()
    {
        _showRealEstatesTableVisible = !_showRealEstatesTableVisible;
        _showDevicesTableVisible = false;
        _showWarrantiesTableVisible = false;
        _showShopsTableVisible = false;
    }
    private void ShowDevicesTable()
    {
        _showDevicesTableVisible = !_showDevicesTableVisible;
        _showWarrantiesTableVisible = false;
        _showShopsTableVisible = false;
        _showRealEstatesTableVisible = false;
    }
    private void ShowWarrantiesTable()
    {
        _showWarrantiesTableVisible = !_showWarrantiesTableVisible;
        _showShopsTableVisible = false;
        _showRealEstatesTableVisible = false;
        _showDevicesTableVisible = false;
    }
    private void ShowShopsTable()
    {
        _showShopsTableVisible = !_showShopsTableVisible;
        _showRealEstatesTableVisible = false;
        _showDevicesTableVisible = false;
        _showWarrantiesTableVisible = false;
    }

    private Modal modal = default!;

    private async Task OnShowModalClick()
    {
        await modal.ShowAsync();
    }

    private async Task OnHideModalClick()
    {
        await modal.HideAsync();
    }

}
